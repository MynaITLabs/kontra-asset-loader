function qFactory(a,b){function c(a,b,d){var e;if(a)if(h(a))for(e in a)"prototype"==e||"length"==e||"name"==e||a.hasOwnProperty&&!a.hasOwnProperty(e)||b.call(d,a[e],e);else if(a.forEach&&a.forEach!==c)a.forEach(b,d);else if(i(a))for(e=0;e<a.length;e++)b.call(d,a[e],e);else for(e in a)a.hasOwnProperty(e)&&b.call(d,a[e],e);return a}function d(a){return a}function e(a){return l(a)}function f(a){var b=j(),d=0,e=i(a)?[]:{};return c(a,function(a,c){d++,k(a).then(function(a){e.hasOwnProperty(c)||(e[c]=a,--d||b.resolve(e))},function(a){e.hasOwnProperty(c)||b.reject(a)},function(a){e.hasOwnProperty(c)||b.notify(a)})}),0===d&&b.resolve(e),b.promise}var g={}.toString,h=function(a){return"function"==typeof a},i=function(a){return"[object Array]"===g.call(a)},j=function(){var c,f,g=[];return f={resolve:function(b){if(g){var d=g;g=void 0,c=k(b),d.length&&a(function(){for(var a,b=0,e=d.length;e>b;b++)a=d[b],c.then(a[0],a[1],a[2])})}},reject:function(a){f.resolve(m(a))},notify:function(b){if(g){var c=g;g.length&&a(function(){for(var a,d=0,e=c.length;e>d;d++)a=c[d],a[2](b)})}},promise:{then:function(a,f,i){var k=j(),l=function(c){try{k.resolve((h(a)?a:d)(c))}catch(e){k.reject(e),b(e)}},m=function(a){try{k.resolve((h(f)?f:e)(a))}catch(c){k.reject(c),b(c)}},n=function(a){try{k.notify((h(i)?i:d)(a))}catch(c){b(c)}};return g?g.push([l,m,n]):c.then(l,m,n),k.promise},"catch":function(a){return this.then(null,a)},"finally":function(a){function b(a,b){var c=j();return b?c.resolve(a):c.reject(a),c.promise}function c(c,e){var f=null;try{f=(a||d)()}catch(g){return b(g,!1)}return f&&h(f.then)?f.then(function(){return b(c,e)},function(a){return b(a,!1)}):b(c,e)}return this.then(function(a){return c(a,!0)},function(a){return c(a,!1)})}}}},k=function(b){return b&&h(b.then)?b:{then:function(c){var d=j();return a(function(){d.resolve(c(b))}),d.promise}}},l=function(a){var b=j();return b.reject(a),b.promise},m=function(c){return{then:function(d,f){var g=j();return a(function(){try{g.resolve((h(f)?f:e)(c))}catch(a){g.reject(a),b(a)}}),g.promise}}},n=function(c,f,g,i){var m,n=j(),o=function(a){try{return(h(f)?f:d)(a)}catch(c){return b(c),l(c)}},p=function(a){try{return(h(g)?g:e)(a)}catch(c){return b(c),l(c)}},q=function(a){try{return(h(i)?i:d)(a)}catch(c){b(c)}};return a(function(){k(c).then(function(a){m||(m=!0,n.resolve(k(a).then(o,p,q)))},function(a){m||(m=!0,n.resolve(p(a)))},function(a){m||n.notify(q(a))})}),n.promise};return{defer:j,reject:l,when:n,all:f}}!function(a){function b(a){if(this.bundles[a])throw new Error("Bundle '"+a+"' already created");this.bundles[a]=Object.create(Object.prototype,{status:{value:"created",writable:!0,enumerable:!1,configurable:!1}})}function c(a){return"[object String]"===g.call(a)}function d(a){return a.match(/\.(jpeg|jpg|gif|png)$/)?"image":a.match(/\.(wav|mp3|ogg|aac|m4a)$/)?"audio":a.match(/\.(js)$/)?"js":a.match(/\.(css)$/)?"css":a.match(/\.(json)$/)?"json":void 0}function e(a){return a.substr((~-a.lastIndexOf(".")>>>0)+2)}function f(a,b){return a.originalMessage=a.message,a.message="AssetManager: "+b+"\n	"+a.stack,a}var g={}.toString,h=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1,i=function(){this.manifestUrl="",this.manifest={},this.assets={},this.assetRoot="./",this.bundles={},this.supportedAssets=["jpeg","jpg","gif","png","wav","mp3","ogg","aac","m4a","js","css","json"];var a=new Audio;this.canPlay={},this.canPlay.wav=a.canPlayType('audio/wav; codecs="1"').replace(/no/,""),this.canPlay.mp3=a.canPlayType("audio/mpeg;").replace(/no/,""),this.canPlay.ogg=a.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""),this.canPlay.aac=a.canPlayType("audio/aac;").replace(/no/,""),this.canPlay.m4a=(a.canPlayType("audio/x-m4a;")||this.canPlay.aac).replace(/no/,"")},j=i.prototype;j.loadManifest=function(a){var b,d,e,f,g=this,h=q.defer();return this.manifestUrl!==a?this.loadJSON(a).then(function(i){g.manifest=i,g.manifestUrl=a,g.assetRoot=i.assetRoot||"./";try{for(b=0,d=i.bundles.length;d>b;b++)e=i.bundles[b],g.createBundle(e.name,!0),g.addBundleAsset(e.name,e.assets,!0)}catch(j){h.reject(j)}i.loadBundles?(c(i.loadBundles)?f="all"===i.loadBundles?Object.keys(g.bundles||{}):[i.loadBundles]:i.loadBundles instanceof Array&&(f=i.loadBundles),g.loadBundle(f).then(function(){h.resolve()},function(a){h.reject(a)},function(a){h.notify(a)})):h.resolve()},function(a){a.message=a.message.replace("JSON","manifest"),h.reject(a)}):(h.resolve()),h.promise},j.createBundle=function(a,c){try{if(a instanceof Array)for(var d=0,e=a.length;e>d;d++)b.call(this,a[d]);else b.call(this,a)}catch(g){throw c?f(g,"Unable to create bundle"):g}},j.loadBundle=function(a){var b,d=this,e=[],g=q.defer(),h=[];a instanceof Array?e=a:c(a)&&(e=[a]);for(var i=0,j=e.length;j>i;i++){if(b=this.bundles[e[i]],!b){var k=new ReferenceError("Bundle not created");return g.reject(f(k,"Unable to load bundle '"+a+"'")),g.promise}b.status="loading",h.push(this.loadAsset(b))}return function(a,b){q.all(h).then(function(){for(var c=0,d=b.length;d>c;c++)a.bundles[b[c]].status="loaded";g.resolve()},function(a){g.reject(a)},function(a){g.notify({loaded:a.loaded,total:a.total})})}(d,e),g.promise},j.addBundleAsset=function(a,b,c){if(!this.bundles[a]){var d=new ReferenceError("Bundle not created");throw c?f(d,"Unable to add asset to bundle '"+a+"'"):d}for(var e in b)b.hasOwnProperty(e)&&(this.bundles[a][e]=b[e])},j.loadAsset=function(a){var b,g,i,j=this,k=0,l=Object.keys(a||{}).length,m=q.defer(),n=[];for(var o in a)if(a.hasOwnProperty(o))switch(b=a[o],g=b instanceof Array?"audio":d(b),i=q.defer(),g){case"image":!function(a,b,c){var d=new Image;d.status="loading",d.name=a,d.onload=function(){d.status="loaded",j.assets[a]=d,c.resolve(),m.notify({loaded:++k,total:l})},d.onerror=function(){c.reject(new Error("Unable to load Image '"+a+"'"))},d.src=b,n.push(c.promise)}(o,b,i);break;case"audio":c(b)&&(b=[b]);for(var p,r,s=0,t=b.length;t>s;s++){p=b[s];var u=(d(p),e(p));if(this.canPlay[u]){r=p;break}}r?(h&&l--,function(a,b,c){var d=new Audio;d.status="loading",d.name=a,d.addEventListener("canplay",function(){d.status="loaded",j.assets[a]=d,c.resolve(),m.notify({loaded:++k,total:l})}),d.onerror=function(){c.reject(new Error("Unable to load Audio '"+a+"'"))},d.src=b,d.preload="auto",d.load(),h?(d.status="loaded",j.assets[a]=d):n.push(c.promise)}(o,r,i)):(i.reject(new Error("Browser cannot play any of the audio types provided for asset '"+o+"'")),n.push(i.promise));break;case"js":this.loadScript(b).then(function(){i.resolve(),m.notify({loaded:++k,total:l})},function(a){i.reject(new Error(a.name+": "+a.message+" '"+o+"' from src '"+b+"'"))}),n.push(i.promise);break;case"css":this.loadCSS(b).then(function(){i.resolve(),m.notify({loaded:++k,total:l})},function(a){i.reject(new Error(a.name+": "+a.message+" '"+o+"' from src '"+b+"'"))}),n.push(i.promise);break;case"json":!function(a,b,c){j.loadJSON(b).then(function(b){j.assets[a]=b,c.resolve(),m.notify({loaded:++k,total:l})},function(d){c.reject(new Error(d.name+": "+d.message+" '"+a+"' from src '"+b+"'"))}),n.push(c.promise)}(o,b,i);break;default:err=new TypeError("Unsupported asset type"),m.reject(f(err,"File type for asset '"+o+"' is not supported. Please use "+this.supportedAssets.join(", ")))}return 0===l?(m.resolve(),m.promise):(q.all(n).then(function(a){m.resolve(a)},function(a){m.reject(a)}),m.promise)},j.loadScript=function(a){var b=q.defer(),c=document.createElement("script");return c.async=!0,c.onload=function(){b.resolve()},c.onerror=function(){var a=new Error;b.reject(f(a,"Unable to load JavaScript file"))},c.src=a,document.body.appendChild(c),b.promise},j.loadCSS=function(a){var b=q.defer(),c=new XMLHttpRequest;return c.addEventListener("load",function(){if(200===c.status&&-1!==c.getResponseHeader("content-type").indexOf("text/css")){var d=document.createElement("style");d.innerHTML=c.responseText,d.setAttribute("data-url",a),document.getElementsByTagName("head")[0].appendChild(d),b.resolve()}else{var e=new Error(c.responseText);b.reject(f(e,"Unable to load CSS file"))}}),c.open("GET",a,!0),c.send(),b.promise},j.loadJSON=function(a){var b=q.defer(),c=new XMLHttpRequest;return c.addEventListener("load",function(){if(200===c.status)try{var a=JSON.parse(c.responseText);b.resolve(a)}catch(d){b.reject(f(d,"Unable to parse JSON file"))}else{var d=new Error(c.responseText);b.reject(f(d,"Unable to load JSON file"))}}),c.open("GET",a,!0),c.send(),b.promise},a.AssetManager=i}(window),window.q=qFactory(function(a){setTimeout(function(){a()},0)},function(a){console.error("qLite: "+a.stack)});