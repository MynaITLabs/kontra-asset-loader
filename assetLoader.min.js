!function(e,t){"use strict";function n(){this.manifestUrl="",this.manifest={},this.assets={},this.assetRoot="./",this.bundles={},this.supportedAssets=["jpeg","jpg","gif","png","wav","mp3","ogg","aac","m4a","js","css","json"],this.isiOS=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;var e=new Audio;this.canPlay={},this.canPlay.wav=e.canPlayType('audio/wav; codecs="1"').replace(/no/,""),this.canPlay.mp3=e.canPlayType("audio/mpeg;").replace(/no/,""),this.canPlay.ogg=e.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""),this.canPlay.aac=e.canPlayType("audio/aac;").replace(/no/,""),this.canPlay.m4a=(e.canPlayType("audio/x-m4a;")||this.canPlay.aac).replace(/no/,"")}function r(e){if(this.bundles[e])throw new Error("Bundle '"+e+"' already created");this.bundles[e]=Object.create(Object.prototype,{status:{value:"created",writable:!0,enumerable:!1,configurable:!1}})}function o(e){var t,n,r=0;for(var o in e)e.hasOwnProperty(o)&&(t=e[o],n=t instanceof Array?"audio":s(t),"audio"!==n||this.isiOS?r++:r++);return r}function a(e){return"[object String]"===l.call(e)}function s(e){return e.match(/\.(jpeg|jpg|gif|png)$/)?"image":e.match(/\.(wav|mp3|ogg|aac|m4a)$/)?"audio":e.match(/\.(js)$/)?"js":e.match(/\.(css)$/)?"css":e.match(/\.(json)$/)?"json":void 0}function i(e){return e.substr((~-e.lastIndexOf(".")>>>0)+2)}function c(e,t){return e.originalMessage=e.message,e.message="AssetLoader: "+t+"\n	"+e.stack,e}function u(e,t){function n(e,t,r){var o;if(e)if(i(e))for(o in e)"prototype"==o||"length"==o||"name"==o||e.hasOwnProperty&&!e.hasOwnProperty(o)||t.call(r,e[o],o);else if(e.forEach&&e.forEach!==n)e.forEach(t,r);else if(c(e))for(o=0;o<e.length;o++)t.call(r,e[o],o);else for(o in e)e.hasOwnProperty(o)&&t.call(r,e[o],o);return e}function r(e){return e}function o(e){return f(e)}function a(e){var t=u(),r=0,o=c(e)?[]:{};return n(e,function(e,n){r++,l(e).then(function(e){o.hasOwnProperty(n)||(o[n]=e,--r||t.resolve(o))},function(e){o.hasOwnProperty(n)||t.reject(e)},function(e){o.hasOwnProperty(n)||t.notify(e)})}),0===r&&t.resolve(o),t.promise}var s={}.toString,i=function(e){return"function"==typeof e},c=function(e){return"[object Array]"===s.call(e)},u=function(){var n,a,s=[];return a={resolve:function(t){if(s){var r=s;s=void 0,n=l(t),r.length&&e(function(){for(var e,t=0,o=r.length;o>t;t++)e=r[t],n.then(e[0],e[1],e[2])})}},reject:function(e){a.resolve(d(e))},notify:function(t){if(s){var n=s;s.length&&e(function(){for(var e,r=0,o=n.length;o>r;r++)e=n[r],e[2](t)})}},promise:{then:function(e,a,c){var l=u(),f=function(n){try{l.resolve((i(e)?e:r)(n))}catch(o){l.reject(o),t(o)}},d=function(e){try{l.resolve((i(a)?a:o)(e))}catch(n){l.reject(n),t(n)}},p=function(e){try{l.notify((i(c)?c:r)(e))}catch(n){t(n)}};return s?s.push([f,d,p]):n.then(f,d,p),l.promise},"catch":function(e){return this.then(null,e)},"finally":function(e){function t(e,t){var n=u();return t?n.resolve(e):n.reject(e),n.promise}function n(n,o){var a=null;try{a=(e||r)()}catch(s){return t(s,!1)}return a&&i(a.then)?a.then(function(){return t(n,o)},function(e){return t(e,!1)}):t(n,o)}return this.then(function(e){return n(e,!0)},function(e){return n(e,!1)})}}}},l=function(t){return t&&i(t.then)?t:{then:function(n){var r=u();return e(function(){r.resolve(n(t))}),r.promise}}},f=function(e){var t=u();return t.reject(e),t.promise},d=function(n){return{then:function(r,a){var s=u();return e(function(){try{s.resolve((i(a)?a:o)(n))}catch(e){s.reject(e),t(e)}}),s.promise}}},p=function(n,a,s,c){var d,p=u(),h=function(e){try{return(i(a)?a:r)(e)}catch(n){return t(n),f(n)}},v=function(e){try{return(i(s)?s:o)(e)}catch(n){return t(n),f(n)}},y=function(e){try{return(i(c)?c:r)(e)}catch(n){t(n)}};return e(function(){l(n).then(function(e){d||(d=!0,p.resolve(l(e).then(h,v,y)))},function(e){d||(d=!0,p.resolve(v(e)))},function(e){d||p.notify(y(e))})}),p.promise};return{defer:u,reject:f,when:p,all:a}}var l={}.toString;n.prototype.loadManifest=function(e){var t,n,r,o,s=this,i=q.defer();return this.manifestUrl!==e?this.loadJSON(e).then(function(c){s.manifest=c,s.manifestUrl=e,s.assetRoot=c.assetRoot||"./";try{for(t=0,n=c.bundles.length;n>t;t++)r=c.bundles[t],s.createBundle(r.name,!0),s.addBundleAsset(r.name,r.assets,!0)}catch(u){i.reject(u)}c.loadBundles?(a(c.loadBundles)?o="all"===c.loadBundles?Object.keys(s.bundles||{}):[c.loadBundles]:c.loadBundles instanceof Array&&(o=c.loadBundles),s.loadBundle(o).then(function(){i.resolve()},function(e){i.reject(e)},function(e){i.notify(e)})):i.resolve()},function(e){e.message=e.message.replace("JSON","manifest"),i.reject(e)}):i.resolve(),i.promise},n.prototype.createBundle=function(e,t){try{if(e instanceof Array)for(var n=0,o=e.length;o>n;n++)r.call(this,e[n]);else r.call(this,e)}catch(a){throw t?c(a,"Unable to create bundle"):a}},n.prototype.loadBundle=function(e){var t,n=this,r=0,s=0,i=[],u=q.defer(),l=[];e instanceof Array?i=e:a(e)&&(i=[e]);for(var f=0,d=i.length;d>f;f++){if(t=this.bundles[i[f]],!t){var p=new ReferenceError("Bundle not created");return u.reject(c(p,"Unable to load bundle '"+e+"'")),u.promise}s+=o.call(this,t),t.status="loading",l.push(this.loadAsset(t))}return function(e,t){q.all(l).then(function(){for(var n=0,r=t.length;r>n;n++)e.bundles[t[n]].status="loaded";u.resolve()},function(e){u.reject(e)},function(){u.notify({loaded:++r,total:s})})}(n,i),u.promise},n.prototype.addBundleAsset=function(e,t,n){if(!this.bundles[e]){var r=new ReferenceError("Bundle not created");throw n?c(r,"Unable to add asset to bundle '"+e+"'"):r}for(var o in t)t.hasOwnProperty(o)&&(this.bundles[e][o]=t[o])},n.prototype.loadAsset=function(e){var t,n,r,u=this,l=0,f=o.call(this,e),d=q.defer(),p=[];for(var h in e)if(e.hasOwnProperty(h))switch(t=e[h],n=t instanceof Array?"audio":s(t),r=q.defer(),n){case"image":!function(e,t,n){var r=new Image;r.status="loading",r.name=e,r.onload=function(){r.status="loaded",u.assets[e]=r,n.resolve(),d.notify({loaded:++l,total:f})},r.onerror=function(){n.reject(new Error("Unable to load Image '"+e+"'"))},r.src=t,p.push(n.promise)}(h,t,r);break;case"audio":a(t)&&(t=[t]);for(var v,y,m=0,g=t.length;g>m;m++){v=t[m];var j=i(v);if(this.canPlay[j]){y=v;break}}y?(this.isiOS&&f--,function(e,t,n){var r=new Audio;r.status="loading",r.name=e,r.addEventListener("canplay",function(){r.status="loaded",u.assets[e]=r,n.resolve(),d.notify({loaded:++l,total:f})}),r.onerror=function(){n.reject(new Error("Unable to load Audio '"+e+"'"))},r.src=t,r.preload="auto",r.load(),u.isiOS?(r.status="loaded",u.assets[e]=r):p.push(n.promise)}(h,y,r)):(r.reject(new Error("Browser cannot play any of the audio types provided for asset '"+h+"'")),p.push(r.promise));break;case"js":this.loadScript(t).then(function(){r.resolve(),d.notify({loaded:++l,total:f})},function(e){r.reject(new Error(e.name+": "+e.message+" '"+h+"' from src '"+t+"'"))}),p.push(r.promise);break;case"css":this.loadCSS(t).then(function(){r.resolve(),d.notify({loaded:++l,total:f})},function(e){r.reject(new Error(e.name+": "+e.message+" '"+h+"' from src '"+t+"'"))}),p.push(r.promise);break;case"json":!function(e,t,n){u.loadJSON(t).then(function(t){u.assets[e]=t,n.resolve(),d.notify({loaded:++l,total:f})},function(r){n.reject(new Error(r.name+": "+r.message+" '"+e+"' from src '"+t+"'"))}),p.push(n.promise)}(h,t,r);break;default:var w=new TypeError("Unsupported asset type");d.reject(c(w,"File type for asset '"+h+"' is not supported. Please use "+this.supportedAssets.join(", ")))}return 0===f?(d.resolve(),d.promise):(q.all(p).then(function(e){d.resolve(e)},function(e){d.reject(e)}),d.promise)},n.prototype.loadScript=function(e){var n=q.defer(),r=t.createElement("script");return r.async=!0,r.onload=function(){n.resolve()},r.onerror=function(){var e=new Error;n.reject(c(e,"Unable to load JavaScript file"))},r.src=e,t.body.appendChild(r),n.promise},n.prototype.loadCSS=function(e){var n=q.defer(),r=new XMLHttpRequest;return r.addEventListener("load",function(){if(200===r.status&&-1!==r.getResponseHeader("content-type").indexOf("text/css")){var o=t.createElement("style");o.innerHTML=r.responseText,o.setAttribute("data-url",e),t.getElementsByTagName("head")[0].appendChild(o),n.resolve()}else{var a=new Error(r.responseText);n.reject(c(a,"Unable to load CSS file"))}}),r.open("GET",e,!0),r.send(),n.promise},n.prototype.loadJSON=function(e){var t=q.defer(),n=new XMLHttpRequest;return n.addEventListener("load",function(){if(200===n.status)try{var e=JSON.parse(n.responseText);t.resolve(e)}catch(r){t.reject(c(r,"Unable to parse JSON file"))}else{var r=new Error(n.responseText);t.reject(c(r,"Unable to load JSON file"))}}),n.open("GET",e,!0),n.send(),t.promise},window.q=u(function(e){setTimeout(function(){e()},0)},function(e){console.error("qLite: "+e.stack)}),e.AssetLoader=n}(window,document);