!function(e,t){"use strict";function n(){this.manifestUrl="",this.manifest={},this.assets={},this.assetRoot="./",this.bundles={},this.supportedAssets=["jpeg","jpg","gif","png","wav","mp3","ogg","aac","m4a","js","css","json"],this.isiOS=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;var e=new Audio;this.canPlay={},this.canPlay.wav=e.canPlayType('audio/wav; codecs="1"').replace(/no/,""),this.canPlay.mp3=e.canPlayType("audio/mpeg;").replace(/no/,""),this.canPlay.ogg=e.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""),this.canPlay.aac=e.canPlayType("audio/aac;").replace(/no/,""),this.canPlay.m4a=(e.canPlayType("audio/x-m4a;")||this.canPlay.aac).replace(/no/,"")}function r(e){if(this.bundles[e])throw new Error("Bundle '"+e+"' already created");this.bundles[e]=Object.create(Object.prototype,{status:{value:"created",writable:!0,enumerable:!1,configurable:!1}})}function o(e){var t,n,r=0;for(var o in e)e.hasOwnProperty(o)&&(t=e[o],n=t instanceof Array?"audio":this.getType(t),"audio"!==n||this.isiOS?r++:r++);return r}function a(e){return"[object String]"===c.call(e)}function s(e,t){return e.originalMessage=e.message,e.message="AssetLoader: "+t+"\n	"+e.stack,e}function i(e,t){function n(e,t,r){var o;if(e)if(i(e))for(o in e)"prototype"==o||"length"==o||"name"==o||e.hasOwnProperty&&!e.hasOwnProperty(o)||t.call(r,e[o],o);else if(e.forEach&&e.forEach!==n)e.forEach(t,r);else if(c(e))for(o=0;o<e.length;o++)t.call(r,e[o],o);else for(o in e)e.hasOwnProperty(o)&&t.call(r,e[o],o);return e}function r(e){return e}function o(e){return f(e)}function a(e){var t=u(),r=0,o=c(e)?[]:{};return n(e,function(e,n){r++,l(e).then(function(e){o.hasOwnProperty(n)||(o[n]=e,--r||t.resolve(o))},function(e){o.hasOwnProperty(n)||t.reject(e)},function(e){o.hasOwnProperty(n)||t.notify(e)})}),0===r&&t.resolve(o),t.promise}var s={}.toString,i=function(e){return"function"==typeof e},c=function(e){return"[object Array]"===s.call(e)},u=function(){var n,a,s=[];return a={resolve:function(t){if(s){var r=s;s=void 0,n=l(t),r.length&&e(function(){for(var e,t=0,o=r.length;o>t;t++)e=r[t],n.then(e[0],e[1],e[2])})}},reject:function(e){a.resolve(d(e))},notify:function(t){if(s){var n=s;s.length&&e(function(){for(var e,r=0,o=n.length;o>r;r++)e=n[r],e[2](t)})}},promise:{then:function(e,a,c){var l=u(),f=function(n){try{l.resolve((i(e)?e:r)(n))}catch(o){l.reject(o),t(o)}},d=function(e){try{l.resolve((i(a)?a:o)(e))}catch(n){l.reject(n),t(n)}},p=function(e){try{l.notify((i(c)?c:r)(e))}catch(n){t(n)}};return s?s.push([f,d,p]):n.then(f,d,p),l.promise},"catch":function(e){return this.then(null,e)},"finally":function(e){function t(e,t){var n=u();return t?n.resolve(e):n.reject(e),n.promise}function n(n,o){var a=null;try{a=(e||r)()}catch(s){return t(s,!1)}return a&&i(a.then)?a.then(function(){return t(n,o)},function(e){return t(e,!1)}):t(n,o)}return this.then(function(e){return n(e,!0)},function(e){return n(e,!1)})}}}},l=function(t){return t&&i(t.then)?t:{then:function(n){var r=u();return e(function(){r.resolve(n(t))}),r.promise}}},f=function(e){var t=u();return t.reject(e),t.promise},d=function(n){return{then:function(r,a){var s=u();return e(function(){try{s.resolve((i(a)?a:o)(n))}catch(e){s.reject(e),t(e)}}),s.promise}}},p=function(n,a,s,c){var d,p=u(),h=function(e){try{return(i(a)?a:r)(e)}catch(n){return t(n),f(n)}},v=function(e){try{return(i(s)?s:o)(e)}catch(n){return t(n),f(n)}},y=function(e){try{return(i(c)?c:r)(e)}catch(n){t(n)}};return e(function(){l(n).then(function(e){d||(d=!0,p.resolve(l(e).then(h,v,y)))},function(e){d||(d=!0,p.resolve(v(e)))},function(e){d||p.notify(y(e))})}),p.promise};return{defer:u,reject:f,when:p,all:a}}var c={}.toString;n.prototype.getExtension=function(e){return e.substr((~-e.lastIndexOf(".")>>>0)+2)},n.prototype.getType=function(e){var t=this.getExtension(e);return t.match(/(jpeg|jpg|gif|png)$/)?"image":t.match(/(wav|mp3|ogg|aac|m4a)$/)?"audio":t.match(/(js)$/)?"js":t.match(/(css)$/)?"css":t.match(/(json)$/)?"json":void 0},n.prototype.loadManifest=function(e){var t,n,r,o,s=this,i=q.defer();return this.manifestUrl!==e?this.loadJSON(e).then(function(c){s.manifest=c,s.manifestUrl=e,s.assetRoot=c.assetRoot||"./";try{for(t=0,n=c.bundles.length;n>t;t++)r=c.bundles[t],s.createBundle(r.name,!0),s.addBundleAsset(r.name,r.assets,!0)}catch(u){i.reject(u)}c.loadBundles?(a(c.loadBundles)?o="all"===c.loadBundles?Object.keys(s.bundles||{}):[c.loadBundles]:c.loadBundles instanceof Array&&(o=c.loadBundles),s.loadBundle(o).then(function(){i.resolve()},function(e){i.reject(e)},function(e){i.notify(e)})):i.resolve()},function(e){e.message=e.message.replace("JSON","manifest"),i.reject(e)}):i.resolve(),i.promise},n.prototype.createBundle=function(e,t){try{if(e instanceof Array)for(var n=0,o=e.length;o>n;n++)r.call(this,e[n]);else r.call(this,e)}catch(a){throw t?s(a,"Unable to create bundle"):a}},n.prototype.loadBundle=function(e){var t,n=this,r=0,i=0,c=[],u=q.defer(),l=[];e instanceof Array?c=e:a(e)&&(c=[e]);for(var f=0,d=c.length;d>f;f++){if(t=this.bundles[c[f]],!t){var p=new ReferenceError("Bundle not created");return u.reject(s(p,"Unable to load bundle '"+e+"'")),u.promise}i+=o.call(this,t),t.status="loading",l.push(this.loadAsset(t))}return function(e,t){q.all(l).then(function(){for(var n=0,r=t.length;r>n;n++)e.bundles[t[n]].status="loaded";u.resolve()},function(e){u.reject(e)},function(){u.notify({loaded:++r,total:i})})}(n,c),u.promise},n.prototype.addBundleAsset=function(e,t,n){if(!this.bundles[e]){var r=new ReferenceError("Bundle not created");throw n?s(r,"Unable to add asset to bundle '"+e+"'"):r}for(var o in t)t.hasOwnProperty(o)&&(this.bundles[e][o]=t[o])},n.prototype.loadAsset=function(e){var t,n,r,a=this,i=0,c=o.call(this,e),u=q.defer(),l=[];for(var f in e)if(e.hasOwnProperty(f))switch(t=e[f],n=t instanceof Array?"audio":this.getType(t),r=q.defer(),n){case"image":!function(e,t,n){a.loadImage(t,e).then(function(){n.resolve(),u.notify({loaded:++i,total:c})},function(r){n.reject(new Error(r.name+": "+r.message+" '"+e+"' from src '"+t+"'"))}),l.push(n.promise)}(f,t,r);break;case"audio":this.isiOS?c--:l.push(r.promise),function(e,t,n){a.loadAudio(t,e).then(function(){n.resolve(),u.notify({loaded:++i,total:c})},function(r){n.reject(new Error(r.name+": "+r.message+" '"+e+"' from src '"+t+"'"))})}(f,t,r);break;case"js":this.loadScript(t).then(function(){r.resolve(),u.notify({loaded:++i,total:c})},function(e){r.reject(new Error(e.name+": "+e.message+" '"+f+"' from src '"+t+"'"))}),l.push(r.promise);break;case"css":this.loadCSS(t).then(function(){r.resolve(),u.notify({loaded:++i,total:c})},function(e){r.reject(new Error(e.name+": "+e.message+" '"+f+"' from src '"+t+"'"))}),l.push(r.promise);break;case"json":!function(e,t,n){a.loadJSON(t,e).then(function(){n.resolve(),u.notify({loaded:++i,total:c})},function(r){n.reject(new Error(r.name+": "+r.message+" '"+e+"' from src '"+t+"'"))}),l.push(n.promise)}(f,t,r);break;default:var d=new TypeError("Unsupported asset type");u.reject(s(d,"File type for asset '"+f+"' is not supported. Please use "+this.supportedAssets.join(", ")))}return 0===c?(u.resolve(),u.promise):(q.all(l).then(function(e){u.resolve(e)},function(e){u.reject(e)}),u.promise)},n.prototype.assetLoaded=function(e){return void 0!==this.assets[e]},n.prototype.loadImage=function(e,t){var n=this,r=q.defer(),o=new Image;return o.status="loading",o.name=t,o.onload=function(){o.status="loaded",n.assets[e]=o,t&&(n.assets[t]=o),r.resolve(o)},o.onerror=function(e){var t=new Error(e.message);r.reject(s(t,"Unable to load Image"))},o.src=e,r.promise},n.prototype.loadAudio=function(e,t){var n=this,r=q.defer();a(e)&&(e=[e]);for(var o,i,c=0,u=e.length;u>c;c++){o=e[c];var l=this.getExtension(o);if(this.canPlay[l]){i=o;break}}if(i)!function(t,o){var a=new Audio;a.status="loading",a.addEventListener("canplay",function(){a.status="loaded",n.assets[e]=a,t&&(n.assets[t]=a),r.resolve(a)}),a.onerror=function(e){var t=new Error(e.message);r.reject(s(t,"Unable to load Audio"))},a.src=o,a.preload="auto",a.load(),n.isiOS&&(a.status="loaded",n.assets[e]=a,t&&(n.assets[t]=a))}(t,i);else{var f=new Error;r.reject(s(f,"Browser cannot play any of the audio types provided"))}return r.promise},n.prototype.loadScript=function(e){var n=q.defer(),r=t.createElement("script");return r.async=!0,r.onload=function(){n.resolve()},r.onerror=function(){var e=new Error;n.reject(s(e,"Unable to load JavaScript file"))},r.src=e,t.body.appendChild(r),n.promise},n.prototype.loadCSS=function(e){var n=q.defer(),r=new XMLHttpRequest;return r.addEventListener("load",function(){if(200===r.status&&-1!==r.getResponseHeader("content-type").indexOf("text/css")){var o=t.createElement("style");o.innerHTML=r.responseText,o.setAttribute("data-url",e),t.getElementsByTagName("head")[0].appendChild(o),n.resolve()}else{var a=new Error(r.responseText);n.reject(s(a,"Unable to load CSS file"))}}),r.open("GET",e,!0),r.send(),n.promise},n.prototype.loadJSON=function(e,t){var n=this,r=q.defer(),o=new XMLHttpRequest;return o.addEventListener("load",function(){if(200===o.status)try{var a=JSON.parse(o.responseText);n.assets[e]=a,t&&(n.assets[t]=a),r.resolve(a)}catch(i){r.reject(s(i,"Unable to parse JSON file"))}else{var i=new Error(o.responseText);r.reject(s(i,"Unable to load JSON file"))}}),o.open("GET",e,!0),o.send(),r.promise},window.q=i(function(e){setTimeout(function(){e()},0)},function(e){console.error("qLite: "+e.stack)}),e.AssetLoader=n}(window,document);